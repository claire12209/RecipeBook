<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Home</title>
    <link rel="stylesheet" type="text/css" href="/css/styles.css"/>
</head>
<body>
    <h2>Welcome to the Recipe Book</h2>
    <p>
        <a th:href="@{/login}">Login</a> | <a th:href="@{/register}">Register</a>
        | <a th:href="@{/profile}" class="btn btn-primary">Go to Profile</a>
    </p>

    <!-- Search Form -->
    <form th:action="@{/home}" method="get">
        <label for="search">Search Recipes:</label>
        <input type="text" id="search" name="query" placeholder="Search by name or ingredient"
               th:value="${query}">
        <button type="submit">Search</button>
    </form>

    <!-- Category Filter Form -->
    <form th:action="@{/home}" method="get">
        <label for="category">Filter by Category:</label>
        <select id="category" name="category">
            <!-- Add the "ALL" option -->
            <option value="ALL" th:selected="${category == 'ALL'}">ALL</option>
            <!-- Loop through categories -->
            <option th:each="category : ${categories}" 
                    th:value="${category.name}" 
                    th:text="${category.name}" 
                    th:selected="${category == category.name}"></option>
        </select>       
        <button type="submit">Filter</button>
    </form>
    

    <h3>All Recipes</h3>
    <ul>
        <!-- Loop through the recipes and display their name, average rating, and share button -->
        <th:block th:each="recipe : ${recipes}">
            <li>
                <!-- Recipe name as a clickable link -->
                <a th:href="@{/recipe/{id}(id=${recipe.id})}" th:text="${recipe.name}">Recipe Title (ID: ${recipe.id})</a>
                
                <!-- Display the average rating for the recipe -->
                <p>Average Rating: <span th:text="${recipe.averageRating}">0</span></p>
                
                <!-- Add a Share button -->
                <button onclick="shareRecipe('http://localhost:8080/recipe/' + /*[[${recipe.id}]]*/ '')">Share</button>
                <!-- <button onclick="shareRecipe('http://localhost:8080/recipe/' + encodeURIComponent('[[${recipe.name}]]'), this)">Share</button> -->
                <!-- <button onclick="shareRecipe('http://localhost:8080/recipe/' + [[${#strings.urlEncode(recipe.name)}]], this)">Share</button> -->
                <!-- <button onclick="shareRecipe('http://localhost:8080/recipe/' + /*[[${#strings.urlEncode(recipe.name)}]]*/, this)">Share</button> -->
            </li>
        </th:block>
    </ul>

    <script>
        function shareRecipe(link, button) {
            // Copy the link to the clipboard
            navigator.clipboard.writeText(link)
                .then(() => {
                    // Change button text to "Copied!"
                    button.textContent = "Copied!";
                    
                    // Reset button text to "Share" after 2 seconds
                    setTimeout(() => {
                        button.textContent = "Share";
                    }, 2000); // 2-second delay
                })
                .catch(err => {
                    console.error("Failed to copy link: ", err);
                    alert("Failed to copy the link. Please try again.");
                });
        }
    </script>
      
    
</body>
</html>
